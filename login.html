<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>เข้าสู่ระบบ Carpool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: radial-gradient(circle at top, #5a54f7 0, #1b1b35 55%, #000 100%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-card {
            width: 100%;
            max-width: 420px;
            border-radius: 24px;
            background-color: #f5f5f7;
            box-shadow: 0 20px 40px rgba(0,0,0,0.35);
            padding: 28px 24px 22px;
        }
        .brand-text {
            font-weight: 600;
            font-size: 1.3rem;
            color: #333;
        }
        .sub-text {
            font-size: .85rem;
            color: #6c6c70;
        }
        .btn-pill {
            border-radius: 999px;
        }
        .emp-label {
            font-size: .85rem;
        }
    </style>
</head>
<body>

<div class="login-card">
    <div class="mb-3">
        <div class="brand-text">Carpool – ระบบจองรถ กดส.</div>
        <div class="sub-text">เข้าสู่ระบบด้วยรหัสพนักงานและรหัสผ่าน</div>
    </div>

    <form id="loginForm" class="mt-3">
        <div class="mb-3">
            <label class="form-label emp-label">รหัสพนักงาน (Employee Code)</label>
            <input type="text" class="form-control" id="empCode" placeholder="เช่น EMP001" required>
        </div>
        <div class="mb-1">
            <label class="form-label emp-label">รหัสผ่าน</label>
            <input type="password" class="form-control" id="password" placeholder="••••••" required>
        </div>
        <div class="mb-3">
            <small class="text-muted">
                * ในระบบจริง ธุรการสามารถกำหนดให้รหัสผ่าน = รหัสพนักงาน หรือกำหนดเองตามนโยบายหน่วยงาน
            </small>
        </div>

        <div class="d-grid">
            <button class="btn btn-primary btn-pill" type="submit">เข้าสู่ระบบ</button>
        </div>
        <div class="mt-3 text-danger small" id="errorMsg" style="display:none;"></div>
    </form>

    <hr class="mt-4 mb-2">
    <div class="small text-muted">
        ตัวอย่างรหัสที่ใช้เข้าสู่ระบบ (mock data):
        <ul class="mb-0">
            <li>พนักงาน: <code>EMP001 / 1234</code></li>
            <li>พนักงาน: <code>EMP002 / 1234</code></li>
            <li>แอดมิน: <code>EMP004 / admin123</code></li>
        </ul>
    </div>
</div>

<script>
    // บัญชีตัวอย่างในระบบ (ปกติจะไปอยู่ใน database)
    const accounts = [
        { code: "EMP001", name: "นางสาว สุทธาสินี แก้วมณี", role: "emp",   password: "1234" },
        { code: "EMP002", name: "นาย ภคิน พันธ์ดี",          role: "emp",   password: "1234" },
        { code: "EMP003", name: "นางสาว ชญานิษฐ์ นาคำ",    role: "emp",   password: "1234" },
        { code: "EMP004", name: "นาย ธราเทพ ศูนย์รถ",       role: "admin", password: "admin123" },
        { code: "EMP005", name: "นางสาว ณัฐกานต์ ศรีบุญเรือง", role: "emp", password: "1234" }
    ];

    // ถ้าเคยล็อกอินค้างไว้แล้ว → เด้งไปหน้าตาม role เลย
    (function autoRedirectIfLoggedIn() {
        const role = localStorage.getItem("role");
        if (role === "admin") {
            window.location.href = "admin.html";
        } else if (role === "emp") {
            window.location.href = "user.html";
        }
    })();

    document.getElementById("loginForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const code = document.getElementById("empCode").value.trim();
        const pass = document.getElementById("password").value;
        const errorMsg = document.getElementById("errorMsg");

        const acc = accounts.find(a => a.code.toLowerCase() === code.toLowerCase() && a.password === pass);

        if (!acc) {
            errorMsg.textContent = "รหัสพนักงานหรือรหัสผ่านไม่ถูกต้อง";
            errorMsg.style.display = "block";
            return;
        }

        // เก็บ session ไว้ใน localStorage
        localStorage.setItem("empCode", acc.code);
        localStorage.setItem("empName", acc.name);
        localStorage.setItem("role", acc.role);

        // แยกหน้า User / Admin ตาม role
        if (acc.role === "admin") {
            window.location.href = "admin.html";
        } else {
            window.location.href = "user.html";
        }
    });
</script>

</body>
</html>
