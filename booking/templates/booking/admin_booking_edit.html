{% extends "booking/base.html" %}
{% load humanize %}

{% block title %}‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏ñ{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">

  <!-- Header + ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-semibold mb-0">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏ñ</h3>

    {# üîπ ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ next ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô #}
    <a href="{{ request.GET.next|default:request.META.HTTP_REFERER }}"
       class="btn btn-outline-secondary btn-sm">
       ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
    </a>
  </div>

  <form method="post" class="card shadow-sm border-0 rounded-4">
    {% csrf_token %}

    {# ‚≠ê‚≠ê ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: ‡πÉ‡∏™‡πà hidden next ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚≠ê‚≠ê #}
    <input type="hidden" name="next" value="{{ request.GET.next }}">

    <div class="card-body">


      <div class="row g-3">

        <!-- ‡∏£‡∏ñ -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏£‡∏ñ</label>
          <select name="car" class="form-select">
            {% for car in cars %}
              <option value="{{ car.id }}"
                {% if car.id == booking.car.id %}selected{% endif %}>
                {{ car.plate_prefix }} {{ car.plate_number }}
                ({{ car.brand_name }} {{ car.model_name }})
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</label>
          <input type="text"
                 class="form-control"
                 value="{{ booking.requester.get_full_name|default:booking.requester.username }}"
                 disabled>
        </div>

        <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏£‡∏ñ</label>
          <input type="date"
                 name="start_date"
                 class="form-control"
                 value="{{ booking.start_date|date:'Y-m-d' }}">
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
          <input type="date"
                 name="end_date"
                 class="form-control"
                 value="{{ booking.end_date|date:'Y-m-d' }}">
        </div>

        <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà -->
        <div class="col-12">
          <label class="form-label fw-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</label>
          <textarea name="destination"
                    class="form-control"
                    rows="2">{{ booking.destination }}</textarea>
        </div>

        <!-- ‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
          <input type="number"
                 name="odometer_before"
                 class="form-control"
                 value="{{ booking.odometer_before }}">
        </div>

        <div class="col-md-6">
          <label class="form-label fw-semibold">‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
          <input type="number"
                 name="odometer_after"
                 class="form-control"
                 value="{{ booking.odometer_after }}">
        </div>

        <!-- ‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ</label>
          <select name="returned_by" class="form-select">
            <option value="">‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‚Äî</option>
            {% for u in users %}
              <option value="{{ u.id }}"
                {% if booking.returned_by and booking.returned_by.id == u.id %}selected{% endif %}>
                {{ u.get_full_name|default:u.username }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
          <select name="co_travelers"
                  id="coTravelers"
                  class="form-select"
                  multiple
                  size="1">
            {% for p in profiles %}
              <option value="{{ p.id }}"
                {% if p in booking.co_travelers.all %}selected{% endif %}>
                {{ p.user.get_full_name|default:p.user.username }}
                {% if p.division %}
                  ({{ p.division }})
                {% endif %}
              </option>
            {% endfor %}
          </select>
          <div class="form-text">
            ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô
          </div>
        </div>

      </div>
    </div>

    <!-- Footer -->
    <div class="card-footer bg-light d-flex justify-content-between">
      {# üîπ ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô #}
      <a href="{{ request.GET.next|default:request.META.HTTP_REFERER }}"
         class="btn btn-secondary">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </a>

      <button type="submit" class="btn btn-primary fw-semibold">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      </button>
    </div>
  </form>

</div>

<!-- JS ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° select multiple ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á -->
<script>
  const select = document.getElementById("coTravelers");

  if (select) {
    select.addEventListener("focus", () => {
      select.size = 6;
    });

    select.addEventListener("change", () => {
      select.size = 1;
      select.blur();
    });

    select.addEventListener("blur", () => {
      select.size = 1;
    });
  }
</script>

{% endblock %}
